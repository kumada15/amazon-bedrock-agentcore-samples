# JWT スコープを使用した AgentCore Gateway インターセプターによるきめ細かなアクセス制御

## 概要
現代のエンタープライズエージェントシステムは、検索、取得、注文システム、分析、ドキュメントパイプラインなど、複数のツールを公開することがよくあります。すべてのユーザーがすべてのツールにアクセスできるべきではなく、異なる役割（アナリスト、マネージャー、監査人、契約者など）には異なるレベルのアクセスが必要な場合があります。AgentCore Gateway のきめ細かなアクセス制御（FGAC）は、Gateway インターセプターを通じてこの課題に対処します。これは、ターゲット宛先に到達する前（Request Interceptor）とレスポンスを呼び出し元のエージェントに返す前（Response Interceptor）の2つの重要なポイントでリクエストを処理するカスタム Lambda 関数です。

![How does it work](images/fgac.png)

### ツール呼び出しのきめ細かなアクセス制御の実装
Gateway インターセプターは、JWT スコープを使用してユーザー権限を検証し、ツール実行前に認可チェックを実装し、完全なターゲットアクセスとツール固有の権限の両方をサポートすることで、ツール呼び出し制御を処理します。不正なアクセスが試みられた場合、Lambda はリクエストがターゲットに到達する前にブロックし、構造化された MCP エラーを返します。これにより、すべてのツールインタラクションで安全なアクセス管理が確保されます。

### 動的ツールフィルタリング
ツール検出とフィルタリングについて、Gateway インターセプターは主に2つの方法（List Tools と Semantic Search）を通じてアクセスを管理します。tools/list 操作を処理する際、レスポンスインターセプターはユーザーの JWT スコープに基づいて利用可能なツールをフィルタリングし、認可されたツールのみが要求元のエージェントに返されるようにします。同様に、セマンティック検索操作では、レスポンスインターセプターは検索結果をエージェントに返す前に処理し、不正なツールを削除し、リスト操作と同じ権限ロジックを適用します。このアプローチは、キャッシングなしで動的な権限更新を維持し、すべての検出方法で一貫したアクセス制御を確保します。

このアクセス制御への包括的なアプローチは、ユーザーの役割と権限に基づく安全なツールアクセス、権限状態のキャッシングなしの動的フィルタリング、すべてのツール検出方法での一貫した認可、既存の認証システムとの簡素化された統合、早期リクエスト検証によるセキュリティリスクの軽減など、いくつかの重要なメリットを提供します。この実装により、ユーザーは安全でスケーラブルなエンタープライズ環境を維持しながら、自分の役割に適したツールのみを検出およびアクセスできるようになります。

### チュートリアル詳細


| 情報                 | 詳細                                                                            |
|:---------------------|:-------------------------------------------------------------------------------|
| チュートリアルタイプ  | インタラクティブ                                                                |
| AgentCore コンポーネント | AgentCore Gateway、AgentCore Identity、AgentCore Runtime、Gateway インターセプター |
| エージェントフレームワーク | Strands Agents                                                               |
| Gateway ターゲットタイプ | MCP サーバー                                                                   |
| Inbound Auth IdP     | Amazon Cognito（他も使用可能）                                                  |
| Outbound Auth        | Amazon Cognito（他も使用可能）                                                  |
| チュートリアル構成    | AgentCore Gateway インターセプターによるきめ細かなアクセス制御                    |
| チュートリアル分野    | クロスバーティカル                                                               |
| 例の複雑さ           | 簡単〜中級                                                                       |
| 使用 SDK             | boto3                                                                           |

## チュートリアルの主な機能

* 主要な MCP アクション用のカスタムスコープを使用した AgentCore Gateway インターセプターによるきめ細かなアクセス制御

## チュートリアル概要

これらのチュートリアルでは、以下の機能をカバーします：

- [カスタムスコープを使用した AgentCore Gateway インターセプターによるきめ細かなアクセス制御](01-fine-grained-access-control-using-custom-scopes.ipynb)

