# フライト予約サービス調査分析

*作成日: 2025-08-02*

## 質問内容
「最近フライト予約サービスの障害を調査したことはありますか？」

## 分析概要

フライト予約サービス調査に関するユーザーの質問は、インフラストラクチャ監視ツール（k8s-api、logs-api、metrics-api、runbooks-api）への呼び出しなしに、**完全にメモリ検索を通じて**回答されました。

## メモリツール使用パターン

Alice_agent.log の分析に基づき、以下の動作が確認されました：

### 1. メモリ検索呼び出し（行 324、331、338）
スーパーバイザーは過去のフライト予約調査を検索するために **3 回の retrieve_memory 呼び出し**を実行：

```
retrieve_memory 呼び出し: type=investigation, query='flight booking service failures', actor_id=Alice, max_results=5
retrieve_memory 呼び出し: type=investigation, query='flight booking', actor_id=Alice, max_results=5
retrieve_memory 呼び出し: type=investigation, query='booking service', actor_id=Alice, max_results=5
```

### 2. メモリ検索結果
3 つのメモリ検索すべてが**空の結果**を返しました - フライト予約サービスに関連する過去の調査は見つかりませんでした。

### 3. 調査サマリーの保存
スーパーバイザーはメモリベースの検索を文書化する調査サマリーを保存：

```json
{
  "incident_id": "memory_search_20250802_203254",
  "query": "have i investigated any failures in the flight booking service recently",
  "resolution_status": "completed",
  "key_findings": [
    "フライト予約サービスに関連する特定の調査は過去の調査レコードで見つかりませんでした",
    "複数のクエリバリエーションを使用して調査サマリー全体でメモリ検索が完了しました"
  ]
}
```

## 主要な発見

### 1. **純粋なメモリベースの応答**
- システムはこれを過去の調査に関する**過去の質問**として正しく識別
- **ライブインフラストラクチャツールは呼び出されませんでした**（k8s-api、logs-api、metrics-api、runbooks-api の呼び出しなし）
- 回答は完全に保存された調査メモリの検索から得られました

### 2. **適切なツール選択**
- **✓ 正しい**: 過去の調査を検索するために `type=investigation` で `retrieve_memory` を使用
- **✓ 正しい**: 過去の質問にはインフラストラクチャ監視ツールを呼び出さなかった
- **✓ 正しい**: 包括的な検索を確保するために複数のクエリバリエーションを使用

### 3. **メモリシステムの有効性**
- メモリシステムは以下を正しく**区別**：
  - **過去の質問** → メモリ検索を使用
  - **現在のステータスの質問** → インフラストラクチャツールを使用
- 空の結果でも、システムは明確な回答を提供：「過去の調査は見つかりませんでした」

### 4. **文書化と学習**
- スーパーバイザーはこのメモリ検索を調査サマリーとして保存
- これにより、誰かがフライト予約サービスについて質問したというレコードが作成される
- 将来の類似の質問はこの検索試行を参照する

## ツール使用分析

| ツールタイプ | 呼び出し？ | ユーザーID | エージェント | 目的 | 結果 |
|-----------|---------|---------|-------|---------|---------|
| `retrieve_memory` | ✓ はい（3回） | Alice | スーパーバイザー | 過去の調査を検索 | 結果なし |
| `k8s-api` | ✗ いいえ | - | - | ライブクラスターステータス | 過去の質問には不要 |
| `logs-api` | ✗ いいえ | - | - | 現在のアプリケーションログ | 過去の質問には不要 |
| `metrics-api` | ✗ いいえ | - | - | 現在のパフォーマンスメトリクス | 過去の質問には不要 |
| `runbooks-api` | ✗ いいえ | - | - | 運用手順 | 過去の質問には不要 |
| `save_investigation` | ✓ はい（1回） | Alice | スーパーバイザー | メモリ検索を文書化 | 検索サマリーの保存成功 |

## 実証されたシステムインテリジェンス

1. **クエリ分類**: 「調査したことがありますか...最近」を過去/メモリの質問として正しく識別
2. **ツール選択**: ライブ監視ツールではなく適切なメモリツールを使用
3. **包括的な検索**: 徹底的な検索を確保するために複数のクエリバリエーションを試行
4. **結果の文書化**: 将来の参照のために検索試行を保存
5. **明確なコミュニケーション**: メモリ検索結果に基づいて明確な回答を提供

## 結論

フライト予約サービスの質問は、SRE エージェントの**メモリとライブツールのインテリジェントな使い分け**を実証：

- **メモリツール**は、過去の調査、ユーザー設定、学習したインフラストラクチャパターンに関する過去の質問に使用
- **インフラストラクチャツール**は、現在のステータス、ライブ監視、アクティブなトラブルシューティングに使用

システムは過去の調査に関する質問に回答するためにメモリ検索を正しく使用し、インフラストラクチャ監視システムへの不要な呼び出しを回避しました。これは、メモリシステムが設計通りに機能していることを示しています - ライブ監視機能を複製するのではなく、過去のコンテキストと組織知識を提供しています。
