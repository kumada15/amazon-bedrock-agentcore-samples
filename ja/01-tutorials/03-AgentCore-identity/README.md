# Amazon Bedrock AgentCore Identity

## 概要

Amazon Bedrock AgentCore Identity は、AIエージェントと自動化されたワークロード向けに特別に設計された包括的なIDと資格情報管理サービスです。ユーザーがエージェントを呼び出し、エージェントがユーザーに代わって外部リソースやサービスにアクセスできるようにしながら、厳格なセキュリティ管理と監査証跡を維持する、安全な認証、認可、資格情報管理機能を提供します。

AgentCore Identity は、AIエージェントデプロイメントにおける基本的な課題に対処します：セキュリティやユーザーエクスペリエンスを損なうことなく、エージェントが複数のサービスにまたがるユーザー固有のデータに安全にアクセスできるようにすること。このサービスは**なりすましではなく委任**の原則に基づいて動作し、エージェントは検証可能なユーザーコンテキストを保持しながら自身として認証します。

## 主な機能

- **インバウンド認証**：エージェントやツールを呼び出すユーザーおよびアプリケーションのアクセスを検証
- **アウトバウンド認証**：ユーザーに代わってエージェントから外部サービスへの安全なアクセス
- **OAuth統合**：2レッグおよび3レッグOAuthフローのサポート
- **AWS IAM統合**：AWSのIDおよびアクセス管理とのネイティブ統合
- **ゼロトラストセキュリティ**：ソースや以前の信頼関係に関係なく、すべてのリクエストを検証
- **クロスプラットフォームサポート**：AWS、他のクラウドプロバイダー、オンプレミス環境で動作

## 認証タイプ

AgentCore Identity は2つの主要な認証パターンをサポートします：

### インバウンド認証
AgentCore Runtime または Gateway ターゲットでエージェントやツールを呼び出すユーザーおよびアプリケーションのアクセスを検証します。サポート内容：
- **AWS IAM**：直接的なIAMベースのアクセス制御
- **OAuth**：エンドユーザーにIAM権限を必要としないトークンベースの認証

### アウトバウンド認証
エージェントがユーザーに代わってAWSサービスと外部リソースにアクセスできるようにします：
- **AWSリソース**：AWSサービスアクセス用のIAM実行ロールを使用
- **外部サービス**：OAuth 2レッグ（クライアント資格情報）および3レッグ（認可コード）フロー


![認証の基本](images/auth_basics3.png)

## 仕組み

AgentCore Identity は、複数の信頼ドメインにまたがる認証と認可を調整する包括的なワークフローを実装します：

1. **ユーザー認証**：ユーザーは既存のIDプロバイダー（Cognito、Auth0など）を通じて認証
2. **エージェント認可**：アプリケーションがユーザートークンでエージェントアクセスを要求
3. **トークン交換**：AgentCore Identity がユーザートークンを検証し、ワークロードアクセストークンを発行
4. **リソースアクセス**：エージェントがワークロードトークンを使用してAWSおよびサードパーティリソースにアクセス
5. **委任と監査**：すべてのアクションがユーザーコンテキストと監査証跡を維持

![仕組み](images/how_it_works.png)

詳細な技術情報については、[AgentCore Identityの仕組み](02-how_it_works.md)を参照してください。

## チュートリアルサンプル

このチュートリアルには、さまざまな認証シナリオを示す4つのハンズオンサンプルが含まれています：

| サンプル | タイプ | 説明 |
|---------|------|-------------|
| **[インバウンド認証サンプル](03-Inbound%20Auth%20example)** | インバウンド | Strands エージェントと Bedrock モデルによるユーザー認証 |
| **[アウトバウンド認証サンプル](04-Outbound%20Auth%20example)** | アウトバウンド | Strands と OpenAI による外部サービスへのエージェントアクセス |
| **[3レッグOAuth](05-Outbound_Auth_3lo)** | アウトバウンド | Cognito と Google との3レッグOAuthフローによるユーザー委任アクセス |
| **[GitHub統合](06-Outbound_Auth_Github)** | アウトバウンド | 3レッグOAuth認証を使用したGitHub APIアクセス |

各サンプルには以下が含まれます：
- 完全なJupyterノートブックのウォークスルー
- ステップバイステップのセットアップ手順
- コードサンプルと説明
- ベストプラクティスとセキュリティの考慮事項

## はじめに

1. **はじめにを読む**：[はじめに](01-getting_started.md)から AgentCore Identity の概念を理解
2. **ワークフローを理解する**：技術的な詳細は[仕組み](02-how_it_works.md)を確認
3. **サンプルを選択**：認証ニーズに基づいてチュートリアルサンプルを選択：
   - エージェントへのユーザー認証：**インバウンド認証サンプル**から開始
   - 外部サービスへのエージェントアクセス：**アウトバウンド認証サンプル**を試す
   - ユーザー委任アクセスパターン：**3レッグOAuth**または**GitHub統合**を探索

## 主なメリット

- **セキュリティ強化**：きめ細かなアクセス制御を備えたゼロトラスト認証
- **ユーザーエクスペリエンス**：繰り返しの認証プロンプトなしのシームレスなアクセス
- **監査とコンプライアンス**：すべてのエージェントアクションの完全な監査証跡
- **フレームワーク非依存**：任意のエージェントフレームワーク（Strands、LangGraph、CrewAIなど）で動作
- **スケーラブル**：複数のIDプロバイダーをサポートするエンタープライズ対応
- **標準ベース**：OAuth 2.0、OIDC、業界セキュリティ標準に基づいて構築

## アーキテクチャ統合

AgentCore Identity は他の AgentCore コンポーネントとシームレスに統合します：

- **AgentCore Runtime**：ホストされたエージェントの認証を提供
- **AgentCore Gateway**：ツールと外部APIへのアクセスを保護
- **AgentCore Memory**：ユーザー固有のメモリストアへの安全なアクセスを維持
- **サードパーティサービス**：外部APIおよびサービスとの安全な統合を可能に

## 次のステップ

チュートリアル完了後、以下が可能です：
- AgentCore Identity を既存のIDインフラストラクチャと統合
- カスタムOAuthプロバイダーとスコープを設定
- 高度なセキュリティポリシーとアクセス制御を実装
- 本番環境対応のエージェント認証ワークフローをデプロイ
- 複数のサービスとプラットフォームにまたがる安全なエージェントインフラストラクチャをスケール
